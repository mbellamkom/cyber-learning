Background: You're part of a delivery company that delivers items globally and recently, you've had some weird things going on with your Sharepoint server, located at your headquarters. 

1. Your DevOps team noticed an unusual spike in CPU usage for the w3wp.exe Sharepoint process and noted it in their report as a low-priority as it was a brief spike. W3wp.exe is a normal Sharepoint process.
2. Helpdesk receives a ticket from an employee trying to download an invoice from Sharepoint. They said they saw some weird behavior with Sharepoint taking them to a blank page. They also found a file containing a lot of gibberish in their downloads folder. They assumed their invoice download was messed up and redownloaded the file. The behavior wasn't reproducible, so it was flagged as a brief browser glitch. 
3. You received a firewall alert about the Sharepoint server connecting to an IP not on your company's approved IP list. Further investigation revealed that the IP belonged to the VPN provider you use. It was noted as a one-off telemetry ping. 
4. Your college intern noticed that w3wp.exe spawned a Powershell process while reviewing Powershell logs. While possible, this is highly unusual.

## Attack Chain 

_This has been modified to fit the cards I had in my deck._

**Initial Compromise - Exploitable External Service**

Authentication was bypassed by sending a specific POST request to an endpoint by manipulating the HTTP referral header. This is an application-level vulnerability as it has to do with Sharepoint's logic. 

 **Pivot and Escalation - Credential store compromise** 
 
Part of the deserialization vulnerability, cryptographic keys are extracted from web.config using a second-stage ASPX file (a malicious web page uploaded to the compromised server). 

 **Persistence - DLL attacks** 
 _Technically, this was a webshell in the actual attack. However, the deck I had didn't have a webshell card and DLL attacks exhibit similar behavior, so it was the card that best fit._
 
Similar to DDL-sideloading/DDL-hijacking, malicious code is wrapped in the w3wp.exe process and executed. 

 **C2 (Command and Control) & Exfil - SaaS Tunneling VPN as C2**

_This one I made up because why wouldn't an attacker disguise their traffic as the company's VPN traffic. This one is probably more likely when a commercial, non-enterprise VPN provider is used._

Data is exfiltrated using the same VPN provider the company uses. 
